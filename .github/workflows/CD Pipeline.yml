name: Continuous Delivery Pipe

on:
  push:
    branches:
      - 'dev'
  workflow_dispatch:
    inputs:
      releaseType:
        description: 'Where to release (dev | staging | prod)?'     
        required: true
        default: 'dev'

jobs:
  dev:
    name: Deploy to Develop
    environment: 
      name: Develop
      url: https://dotnetmona-dev.azurewebsites.net/
    if: ${{ github.event_name == 'push' || github.event.inputs.releaseType == 'dev' }}

    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v4

  staging:
    name: Deploy to Staging
    environment: 
      name: Staging
      url: https://dotnetmona-staging.azurewebsites.net/
    if: ${{ github.event_name == 'workflow_dispatch' && github.event.inputs.releaseType == 'staging' }}

    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v4
    
  prod:
    name: Deploy to Prod
    environment: 
        name: Production
        url: https://dotnetmona.azurewebsites.net/
    if: ${{ github.event_name == 'workflow_dispatch' && github.event.inputs.releaseType == 'prod' }}

    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v2